#!/bin/bash
# Pre-commit hook: auto-format, lint, and test before each commit

echo "Running pre-commit checks..."

# Auto-format staged files, then re-stage them
make fmt 2>/dev/null
git add -u src/ 2>/dev/null

# Lint (no format check — we just formatted)
if ! make lint; then
    echo ""
    echo "❌ Lint failed! Fix the issues above, then try again."
    echo "To skip: git commit --no-verify"
    exit 1
fi

echo "✓ Lint passed"

# Test
if ! make test; then
    echo ""
    echo "❌ Tests failed! Fix the failing tests, then try again."
    echo "To skip: git commit --no-verify"
    exit 1
fi

echo "✓ All pre-commit checks passed"
